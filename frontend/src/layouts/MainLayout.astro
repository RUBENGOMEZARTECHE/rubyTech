---
export interface Props {
  title?: string;
}
const { title = 'RubyTech' } = Astro.props;
---

<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{title} ‚Äî RubyTech</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <link rel="stylesheet" href="/src/styles/global.css" />
</head>
<body>

<!-- NAVIGATION -->
<nav class="nav" id="navbar">
  <a href="/" class="nav-logo">
    <i class="fa-solid fa-gem"></i>
    <span>RubyTech</span>
  </a>
  <div class="nav-links" id="navLinks">
    <a href="/" class="nav-link"><i class="fa-solid fa-house"></i> Inicio</a>
    <a href="/catalogo" class="nav-link"><i class="fa-solid fa-grid-2"></i> Cat√°logo</a>
    <a href="/blog" class="nav-link"><i class="fa-solid fa-newspaper"></i> Blog</a>
    <a href="/contacto" class="nav-link"><i class="fa-solid fa-envelope"></i> Contacto</a>
  </div>
  <div style="display:flex;align-items:center;gap:.6rem">
    <button class="nav-cart" id="btnCarrito">
      <i class="fa-solid fa-cart-shopping"></i>
      <span class="badge">0</span>
    </button>
    <button class="menu-toggle" id="menuToggle">
      <i class="fa-solid fa-bars"></i>
    </button>
  </div>
</nav>

<!-- CONTENIDO DE LA P√ÅGINA -->
<slot />

<!-- FOOTER -->
<footer class="footer">
  <div class="footer-grid">
    <div class="footer-brand">
      <h3><i class="fa-solid fa-gem"></i> <span>RubyTech</span></h3>
      <p>Tu tienda de confianza en electr√≥nica premium. Los mejores productos al mejor precio con garant√≠a y env√≠o r√°pido.</p>
      <div class="footer-socials">
        <a href="#"><i class="fa-brands fa-facebook-f"></i></a>
        <a href="#"><i class="fa-brands fa-twitter"></i></a>
        <a href="#"><i class="fa-brands fa-instagram"></i></a>
        <a href="#"><i class="fa-brands fa-youtube"></i></a>
        <a href="#"><i class="fa-brands fa-tiktok"></i></a>
      </div>
    </div>
    <div class="footer-col">
      <h4>Categor√≠as</h4>
      <a href="/catalogo?cat=moviles">M√≥viles</a>
      <a href="/catalogo?cat=portatiles">Port√°tiles</a>
      <a href="/catalogo?cat=ordenadores-de-sobremesa">Sobremesa</a>
    </div>
    <div class="footer-col">
      <h4>Empresa</h4>
      <a href="#">Sobre nosotros</a>
      <a href="/blog">Blog</a>
      <a href="/contacto">Contacto</a>
    </div>
    <div class="footer-col">
      <h4>Ayuda</h4>
      <a href="#">Env√≠os y entregas</a>
      <a href="#">Devoluciones</a>
      <a href="#">Garant√≠a</a>
      <a href="#">Preguntas frecuentes</a>
    </div>
  </div>
  <div class="footer-bottom">
    <p>&copy; 2024 RubyTech. Todos los derechos reservados. Dise√±ado con <i class="fa-solid fa-heart" style="color:var(--red)"></i></p>
  </div>
</footer>

<script>
  // Navbar scroll effect
  window.addEventListener('scroll', () => {
    const nav = document.getElementById('navbar');
    nav?.classList.toggle('scrolled', window.scrollY > 50);
  });

  // Mobile menu toggle
  document.getElementById('menuToggle')?.addEventListener('click', () => {
    document.getElementById('navLinks')?.classList.toggle('open');
  });

  // Marcar enlace activo
  const links = document.querySelectorAll('.nav-link');
  links.forEach(link => {
    if (link.getAttribute('href') === window.location.pathname) {
      link.classList.add('active');
    }
  });
</script>

<!-- CARRITO LATERAL -->
<div id="carritoOverlay" class="hidden fixed inset-0 bg-black/60 z-[1999] backdrop-blur-sm"></div>

<div id="carritoPanel" class="fixed top-0 right-[-420px] w-[420px] h-screen z-[2000] flex flex-col transition-all duration-300" style="background:var(--bg2);border-left:1px solid rgba(255,255,255,.08)">

  <!-- HEADER -->
  <div class="flex justify-between items-center p-6" style="border-bottom:1px solid rgba(255,255,255,.08)">
    <h3 class="text-xl font-black">üõí Tu carrito</h3>
    <button id="cerrarCarrito" class="w-9 h-9 rounded-xl cursor-pointer text-lg" style="background:var(--bg3);border:none;color:var(--text)">‚úï</button>
  </div>

  <!-- ITEMS -->
  <div id="carritoItems" class="flex-1 overflow-y-auto p-4"></div>

  <!-- VAC√çO -->
  <div id="carritoVacio" class="hidden flex-1 flex-col items-center justify-center gap-4 text-center p-8">
    <i class="fa-solid fa-cart-shopping text-5xl" style="color:var(--text3)"></i>
    <p style="color:var(--text3)">Tu carrito est√° vac√≠o</p>
    <a href="/catalogo" class="btn btn-primary" onclick="cerrarCarrito()"><i class="fa-solid fa-bag-shopping"></i> Ver Cat√°logo</a>
  </div>

  <!-- FOOTER -->
  <div id="carritoFooter" class="hidden p-6" style="border-top:1px solid rgba(255,255,255,.08)">
    <div class="flex justify-between mb-2 text-sm" style="color:var(--text2)">
      <span>Subtotal</span><span id="carritoSubtotal">0‚Ç¨</span>
    </div>
    <div class="flex justify-between mb-4 text-sm" style="color:var(--text2)">
      <span>Env√≠o</span><span style="color:var(--green)">Gratis</span>
    </div>
    <div class="flex justify-between font-black text-xl mb-6" style="border-top:1px solid rgba(255,255,255,.08);padding-top:1rem">
      <span>Total</span>
      <span id="carritoTotal" style="background:linear-gradient(135deg,var(--primary),var(--accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent">0‚Ç¨</span>
    </div>
    <button class="btn btn-primary w-full justify-center" onclick="alert('¬°Gracias por tu compra!')">
      <i class="fa-solid fa-credit-card"></i> Finalizar compra
    </button>
  </div>

</div>

<script is:inline>
  function getCarrito() {
    return JSON.parse(localStorage.getItem('carrito') || '[]');
  }

  function saveCarrito(carrito) {
    localStorage.setItem('carrito', JSON.stringify(carrito));
    actualizarBadge();
  }

  function actualizarBadge() {
    var carrito = getCarrito();
    var total = carrito.reduce(function(t, i) { return t + i.cantidad; }, 0);
    var badge = document.querySelector('.nav-cart .badge');
    if (badge) badge.textContent = total.toString();
  }

  function getIcono(catSlug) {
    if (catSlug === 'moviles') return 'fa-mobile-screen-button';
    if (catSlug === 'portatiles') return 'fa-laptop';
    return 'fa-desktop';
  }

  function renderCarrito() {
    var carrito = getCarrito();
    var itemsEl = document.getElementById('carritoItems');
    var vacioEl = document.getElementById('carritoVacio');
    var footerEl = document.getElementById('carritoFooter');

    if (!itemsEl) return;

    if (carrito.length === 0) {
      itemsEl.style.display = 'none';
      vacioEl.style.display = 'flex';
      footerEl.style.display = 'none';
      return;
    }

    vacioEl.style.display = 'none';
    itemsEl.style.display = 'block';
    footerEl.style.display = 'block';

    var html = '';
    for (var i = 0; i < carrito.length; i++) {
      var item = carrito[i];
      html += '<div class="rounded-xl p-4 mb-3 grid gap-3 items-center" style="background:var(--bg3);grid-template-columns:50px 1fr">';
      html += '<div class="w-12 h-12 rounded-lg flex items-center justify-center text-xl" style="background:var(--bg4);color:rgba(255,255,255,.2)">';
      html += '<i class="fa-solid ' + getIcono(item.catSlug) + '"></i></div>';
      html += '<div>';
      html += '<div class="text-xs font-bold uppercase tracking-widest" style="color:var(--accent)">' + item.brand + '</div>';
      html += '<div class="font-bold text-sm my-1">' + item.name + '</div>';
      html += '<div class="flex items-center justify-between mt-2">';
      html += '<div class="flex items-center gap-2">';
      html += '<button onclick="cambiarCantidad(\'' + item.id + '\', -1)" class="w-7 h-7 rounded-lg cursor-pointer text-base" style="background:var(--bg2);color:var(--text);border:1px solid rgba(255,255,255,.1)">‚àí</button>';
      html += '<span class="font-bold text-sm">' + item.cantidad + '</span>';
      html += '<button onclick="cambiarCantidad(\'' + item.id + '\', 1)" class="w-7 h-7 rounded-lg cursor-pointer text-base" style="background:var(--bg2);color:var(--text);border:1px solid rgba(255,255,255,.1)">+</button>';
      html += '</div>';
      html += '<div class="flex items-center gap-3">';
      html += '<span class="font-black text-sm" style="background:linear-gradient(135deg,var(--primary),var(--accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent">' + (item.price * item.cantidad).toLocaleString('es-ES') + '‚Ç¨</span>';
      html += '<button onclick="eliminarItem(\'' + item.id + '\')" class="cursor-pointer text-sm" style="background:none;border:none;color:var(--red)"><i class="fa-solid fa-trash"></i></button>';
      html += '</div></div></div></div>';
    }
    itemsEl.innerHTML = html;

    var total = carrito.reduce(function(t, i) { return t + i.price * i.cantidad; }, 0);
    document.getElementById('carritoSubtotal').textContent = total.toLocaleString('es-ES') + '‚Ç¨';
    document.getElementById('carritoTotal').textContent = total.toLocaleString('es-ES') + '‚Ç¨';
  }

  function abrirCarrito() {
    document.getElementById('carritoPanel').style.right = '0';
    document.getElementById('carritoOverlay').classList.remove('hidden');
    document.getElementById('carritoOverlay').classList.add('block');
    renderCarrito();
  }

  function cerrarCarrito() {
    document.getElementById('carritoPanel').style.right = '-420px';
    document.getElementById('carritoOverlay').classList.add('hidden');
    document.getElementById('carritoOverlay').classList.remove('block');
  }

  window.cambiarCantidad = function(id, delta) {
    var carrito = getCarrito();
    for (var i = 0; i < carrito.length; i++) {
      if (carrito[i].id === id) {
        carrito[i].cantidad += delta;
        if (carrito[i].cantidad <= 0) carrito.splice(i, 1);
        break;
      }
    }
    saveCarrito(carrito);
    renderCarrito();
  }

  window.eliminarItem = function(id) {
    saveCarrito(getCarrito().filter(function(i) { return i.id !== id; }));
    renderCarrito();
  }

  document.addEventListener('DOMContentLoaded', function() {
    actualizarBadge();
    document.getElementById('btnCarrito').addEventListener('click', abrirCarrito);
    document.getElementById('cerrarCarrito').addEventListener('click', cerrarCarrito);
    document.getElementById('carritoOverlay').addEventListener('click', cerrarCarrito);
  });
</script>

</body>
</html>