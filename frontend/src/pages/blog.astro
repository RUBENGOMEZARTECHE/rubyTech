---
import MainLayout from '../layouts/MainLayout.astro';
import { getBlogPosts } from '../lib/api.js';

const posts = await getBlogPosts(); //Llama a la funcion y espera que strapi devuelva todos los post
---

<MainLayout title="Blog">
  <section class="section" style="padding-top:100px">
    <div class="section-header">
      <h2>Blog <span class="gradient">RubyTech</span></h2>
      <p>Noticias, guías y análisis del mundo tecnológico</p>
    </div>

    <div class="blog-grid">
      {posts.length === 0 ? ( //Comprobamos si hay post, si no hay = mensaje "No hay articulos publicados todavia"
        <div class="no-results">
          <i class="fa-solid fa-newspaper"></i>
          <p>No hay artículos publicados todavía</p>
        </div>
      ) : (
        posts.map((post: any) => ( //Si hay post lo muestra usando el metodo .map
          <a href={`/blog/${post.slug}`} class="blog-card"> {/*CREA UNA TARJETA POR POST */}
            <div class="blog-img" style="background:linear-gradient(135deg,var(--bg3),var(--bg4))">
              <span class="blog-cat">{post.category}</span>
              {post.coverImage?.url //Si el post tiene imagen, la muestra, sino muestra el icono del periodico
                ? <img src={`http://46.62.132.241:1337${post.coverImage.url}`} alt={post.title} style="width:100%;height:100%;object-fit:cover;position:absolute;inset:0" />
                : <i class="fa-solid fa-newspaper"></i>
              }
            </div>

            {/*CONTENIDO DE LA TARJETA */}
            <div class="blog-content"> 
              <div class="blog-meta">
                <span><i class="fa-regular fa-calendar"></i> {post.publishedDate}</span>
                <span><i class="fa-regular fa-user"></i> {post.author}</span>
                <span><i class="fa-regular fa-clock"></i> {post.readingTime} min</span>
              </div>
              <h3>{post.title}</h3>
              <p>{post.excerpt}</p>
              <span class="blog-read">Leer más <i class="fa-solid fa-arrow-right"></i></span>
            </div>
          </a>
        ))
      )}
    </div> 
  </section>
</MainLayout>