---
import MainLayout from '../../layouts/MainLayout.astro';
import { getBlogPosts, getBlogPostBySlug } from '../../lib/api.js';

export async function getStaticPaths() {
  const posts = await getBlogPosts();
  return posts.map((p: any) => ({
    params: { slug: p.slug },
  }));
}

const { slug } = Astro.params;
const post = await getBlogPostBySlug(slug!);

if (!post) return Astro.redirect('/blog');
---

<MainLayout title={post.title}>
  <section class="section" style="padding-top:100px">
    <div class="blog-detail-content">

      <a href="/blog" class="detail-back">
        <i class="fa-solid fa-arrow-left"></i> Volver al blog
      </a>

      <h1>{post.title}</h1>

      <div class="blog-detail-meta">
        <span><i class="fa-regular fa-calendar"></i> {post.publishedDate}</span>
        <span><i class="fa-regular fa-user"></i> {post.author}</span>
        <span><i class="fa-regular fa-clock"></i> {post.readingTime} min de lectura</span>
        <span><i class="fa-solid fa-tag"></i> {post.category}</span>
      </div>

      <div class="blog-body">
        {post.content?.map((block: any) => {
          if (block.type === 'paragraph') {
            return <p>{block.children?.map((c: any) => c.text).join('')}</p>;
          }
          if (block.type === 'heading') {
            const Tag = `h${block.level}` as any;
            return <Tag>{block.children?.map((c: any) => c.text).join('')}</Tag>;
          }
          if (block.type === 'list') {
            return (
              <ul>
                {block.children?.map((item: any) => (
                  <li>{item.children?.map((c: any) => c.text).join('')}</li>
                ))}
              </ul>
            );
          }
        })}
      </div>

    </div>
  </section>
</MainLayout>

<style>
.blog-detail-content { max-width: 800px; margin: 0 auto; }
.blog-detail-content h1 { font-size: 2rem; font-weight: 800; margin-bottom: 1rem; line-height: 1.3; }
.blog-detail-meta { display: flex; gap: 1.5rem; margin-bottom: 2rem; padding-bottom: 1.5rem; border-bottom: 1px solid rgba(255,255,255,.06); color: var(--text3); font-size: .9rem; flex-wrap: wrap; }
.blog-body { color: var(--text2); line-height: 1.8; font-size: 1rem; }
.blog-body p { margin-bottom: 1.2rem; }
.blog-body h2, .blog-body h3 { color: var(--text); margin: 2rem 0 1rem; font-size: 1.3rem; }
.blog-body ul { margin: 1rem 0 1.5rem 1.5rem; }
.blog-body ul li { margin-bottom: .5rem; }
</style>